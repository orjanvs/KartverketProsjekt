@using KartverketProsjekt.Models.ViewModels
@model List<ListReportsViewModel>

<head>
    @* Link to the custom CSS file for table styling *@
    <link href="~/css/sortTableStyle.css" rel="stylesheet">

    @* Font Awesome for search icon *@
    <script src="https://kit.fontawesome.com/5eea027e19.js" crossorigin="anonymous"></script>

    @* jQuery for easier DOM manipulation and event handling *@
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
</head>

<div class="box">
    <i class="fa-solid fa-magnifying-glass"></i>
    <input type="text" id="searchTable" placeholder="Søk..." />
</div>

<body>
    <div class="container mt-3">
        <div class="filter-container">
            @* Filter by status dropdown *@
            <div class="filter-box">
                <label for="filterStatusDropdown" class="me-2 text-dark">Filter by Status:</label>
                <select id="filterStatusDropdown" class="form-select">
                    <option value="All">Show All</option>
                    <option value="Pending">Pending</option>
                    <option value="In Progress">In Progress</option>
                    <option value="Completed">Completed</option>
                    <option value="Rejected">Rejected</option>
                </select>
            </div>

            @* Filter by map layer (Kartlag) dropdown *@
            <div class="filter-box">
                <label for="filterKartlagDropdown" class="me-2 text-dark">Filter by Kartlag:</label>
                <select id="filterKartlagDropdown" class="form-select">
                    <option value="All">Show All</option>
                    <option value="Turkart">Turkart</option>
                    <option value="Sjøkart">Sjøkart</option>
                    <option value="Fargekart">Fargekart</option>
                    <option value="Gråtonekart">Gråtonekart</option>
                </select>
            </div>
        </div>
    </div>
</body>

<div id="portexe-search-root">
    <div id="portexe-table-container">

        @* Check if the model contains any reports *@
        @if (Model != null && Model.Any())
        {
            @* Display a sortable table for map reports *@
            <table class="table table-sortable" id="firstTableId">
                <thead>
                    <tr>
                        <th>Dato</th>
                        <th>Tittel</th>
                        <th>Fylke</th>
                        <th>Kommune</th>
                        <th>Kartlag</th>
                        <th>Vedlegg</th> 
                        <th>Status</th>
                    </tr>
                </thead>
                <tbody id="myTable">
                    @* Iterate over each map report and display its data *@
                    @foreach (var mapReport in Model)
                    {
                        <tr>
                            <td>@mapReport.SubmissionDate</td>
                            <td>@mapReport.Title</td>
                            <td>@mapReport.County</td>
                            <td>@mapReport.Municipality</td>
                            <td>@mapReport.MapLayerType</td>
                            <td>
                                @* Display badge indicating attachment status *@
                                @if (mapReport.HasAttachments)
                                {
                                    <span class="badge bg-success">Vedlegg tilgjengelig</span>
                                }
                                else
                                {
                                    <span class="badge bg-secondary">Ingen vedlegg</span>
                                }
                            </td>
                            <td>@mapReport.StatusDescription</td>

                            @* Link to view report details *@
                            <td>
                                <a asp-area=""
                                   asp-controller="MapReport"
                                   asp-action="ViewReport"
                                   asp-route-id="@mapReport.MapReportId">
                                    <img src="~/images/green-arrow.svg" alt="Gå til" style="height: 40px;" />
                                </a>
                            </td>
                        </tr>
                    }
                </tbody>
            </table>
        }
        else
        {
            @* Display message if no reports are found *@
            <p>Ingen innmeldinger funnet!</p>
        }
    </div>
</div>

<div>

    @* Pagination controls to navigate through pages *@
    @if (ViewBag.PageNumber > 1)
    {
        // If the current page is greater than 1, then the "Previous" link is enabled
        <a asp-action="ListForm" asp-route-pageNumber="@(ViewBag.PageNumber - 1)" asp-route-pageSize="@ViewBag.PageSize">Forrige side</a>
    }
    @if (Model.Count == ViewBag.PageSize) 
    {
        // If the number of items in the current page is equal to the page size, then the "Next" link is enabled
        <a asp-action="ListForm" asp-route-pageNumber="@(ViewBag.PageNumber + 1)" asp-route-pageSize="@ViewBag.PageSize">Neste side</a>
    }
</div>

@* Pass the model data as JSON to the client-side script *@
<script>var modelData = @Html.Raw(Json.Serialize(Model));</script>

@* JavaScript for filtering and sorting the list *@
<script src="~/js/filterList.js" defer></script>
